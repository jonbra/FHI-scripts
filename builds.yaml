# This is where we define which builds we'd like to run.
# This example includes one minimal global build.

# Each build needs a name, a defined subsampling process, and geographic attributes used for subsampling.
# Geography is specified by build attributes (e.g., `region`, `country`, `division`, `location`) that are referenced from subsampling schemes.

# The default config file, `./defaults/parameters.yaml` has reasonable default subsampling methods for each geographic resolution.
# These subsample primarily from the area of interest ("focus"), and add in background ("contextual") sequences from the rest of the world.
# Contextual sequences that are genetically similar to (hamming distance) and geographically near the focal sequences are heavily prioritized.

# S3_DST_BUCKET: "nextstrain-ncov-private"
# S3_DST_COMPRESSION: "xz"
# S3_DST_ORIGINS: ["gisaid"]
# upload:
#   - build-files

# S3_BUCKET: "nextstrain-niph"
use_nextalign: true
genes: ["ORF1a", "ORF1b", "S", "ORF3a", "E", "M", "ORF6", "ORF7a", "ORF7b", "ORF8", "N", "ORF9b"]


# In this example, we use these default methods. See other templates for examples of how to customize this subsampling scheme.
builds:

#  omicron_ba_two:
#    region: global
#    country: Norway
#    subsampling_scheme: omicron-batwo-scheme
#    pango_lineage: "['BA.2', 'BA.2.1', 'BA.2.2', 'BA.2.3', 'BA.2.3.1', 'BA.2.3.2', 'BA.2.3.3', 'BA.2.3.4', 'BA.2.3.5', 'BA.2.3.6', 'BA.2.3.7', 'BA.2.3.8', 'BA.2.3.9', 'BA.2.3.10', 'BA.2.3.11', 'BA.2.3.12', 'BA.2.3.13', 'BA.2.3.14', 'BA.2.3.15', 'BA.2.3.16', 'BA.2.3.17', 'BA.2.3.18', 'BA.2.4', 'BA.2.5', 'BA.2.6', 'BA.2.7', 'BA.2.8', 'BA.2.9', 'BA.2.9.1', 'BA.2.9.2', 'BA.2.9.3', 'BA.2.9.4', 'BA.2.10', 'BA.2.10.1', 'BA.2.10.2', 'BA.2.10.3', 'BA.2.11', 'BA.2.12', 'BA.2.12.1', 'BA.2.12.2', 'BA.2.13', 'BA.2.14', 'BA.2.15', 'BA.2.16', 'BA.2.17', 'BA.2.18', 'BA.2.19', 'BA.2.20', 'BA.2.21', 'BA.2.22', 'BA.2.23', 'BA.2.23.1', 'BA.2.24', 'BA.2.25', 'BA.2.25.1', 'BA.2.26', 'BA.2.27', 'BA.2.28', 'BA.2.29', 'BA.2.30', 'BA.2.31', 'BA.2.32', 'BA.2.33', 'BA.2.34', 'BA.2.35', 'BA.2.36', 'BA.2.37', 'BA.2.38', 'BA.2.39', 'BA.2.40', 'BA.2.40.1','BA.2.41', 'BA.2.42', 'BA.2.43', 'BA.2.44', 'BA.2.45', 'BA.2.46', 'BA.2.47', 'BA.2.48', 'BA.2.49', 'BA.2.50', 'BA.2.51', 'BA.2.52', 'BA.2.53', 'BA.2.54', 'BA.2.55', 'BA.2.56', 'BA.2.57', 'BA.2.58', 'BA.2.59', 'BA.2.60', 'BA.2.61', 'BA.2.62', 'BA.2.63', 'BA.2.64', 'BA.2.65', 'BA.2.66', 'BA.2.67', 'BA.2.68', 'BA.2.69', 'BA.2.70', 'BA.2.71', 'BA.2.72', 'BA.3', 'BA.3.1', 'BA.4', 'BA.4.1', 'BA.4.2', 'BA.5', 'BA.5.1', 'BA.5.2', 'BA.5.3', 'BA.5.4', 'BA.5.5', 'XE', 'XG', 'XH', 'XJ', 'XK', 'XL', 'XM', 'XN', 'XP', 'XQ', 'XR', 'XT', 'XU']"

  omicron_bq:
    region: global
    country: Norway
    subsampling_scheme: omicron-bq-scheme
    
  omicron_ba_five:
    region: global
    country: Norway
    subsampling_scheme: omicron-bafive-scheme
    # Lineage list updated from https://github.com/cov-lineages/pango-designation/blob/master/lineage_notes.txt. Extracted all B.1.1.529.5
    pango_lineage: "['BA.5', 'BA.5.1', 'BA.5.1.1', 'BA.5.1.2', 'BA.5.1.3', 'BA.5.1.4', 'BA.5.1.5', 'BA.5.1.6', 'BA.5.1.7', 'BA.5.1.8', 'BA.5.1.9', 'BA.5.1.10', 'BK.1', 'BA.5.1.11', 'BA.5.1.12', 'BA.5.1.14', 'BA.5.1.15', 'DL.1', 'BA.5.1.16', 'BA.5.1.17', 'BA.5.1.18', 'BA.5.1.19', 'BA.5.1.20', 'BA.5.1.21', 'BT.1', 'BT.2', 'BA.5.1.22', 'DH.1', 'BA.5.1.23', 'DE.1', 'DE.2', 'BA.5.1.24', 'BA.5.1.25', 'DJ.1', 'DJ.1.1', 'DJ.1.1.1', 'DJ.1.2', 'DJ.1.3', 'BA.5.1.26', 'CU.1', 'BA.5.1.27', 'BA.5.1.28', 'BA.5.1.29', 'CL.1', 'BA.5.1.30', 'BA.5.1.31', 'BA.5.1.32', 'BA.5.2', 'BA.5.2.1', 'BF.1', 'BF.1.1', 'BF.2', 'BF.3', 'BF.3.1', 'BF.4', 'BF.5', 'BF.5.1', 'BF.5.2', 'BF.6', 'BF.7', 'BF.7.1', 'BF.7.2', 'BF.7.3', 'BF.7.4', 'BF.7.4.1', 'BF.7.4.2', 'BF.7.5', 'BF.7.5.1', 'BF.7.6', 'BF.7.7', 'BF.7.8', 'BF.7.9', 'BF.7.10', 'BF.7.11', 'BF.7.12', 'BF.7.13', 'BF.7.13.1', 'BF.7.13.2', 'BF.7.14', 'BF.7.14.1', 'BF.7.14.2', 'BF.7.14.3', 'BF.7.15', 'BF.8', 'BF.9', 'BF.10', 'BF.10.1', 'BF.11', 'BF.11.1', 'BF.11.2', 'BF.11.3', 'BF.11.4', 'BF.11.5', 'BF.12', 'BF.13', 'BF.14', 'BF.15', 'BF.16', 'BF.17', 'BF.18', 'BF.19', 'BF.20', 'BF.21', 'BF.22', 'BF.23', 'BF.24', 'BF.25', 'BF.26', 'BF.27', 'BF.28', 'BF.29', 'BF.30', 'BF.31', 'BF.31.1', 'BF.32', 'BF.33', 'BF.34', 'BA.5.2.2', 'BA.5.2.3', 'BZ.1', 'BA.5.2.4', 'BA.5.2.5', 'BA.5.2.6', 'CP.1', 'CP.1.1', 'CP.1.2', 'CP.1.3', 'CP.2', 'CP.3', 'CP.4', 'CP.5', 'CP.6', 'BA.5.2.7', 'CY.1', 'BA.5.2.8', 'BA.5.2.9', 'BA.5.2.10', 'BA.5.2.11', 'BA.5.2.12', 'BA.5.2.13', 'BA.5.2.14', 'BA.5.2.16', 'BU.1', 'BU.2', 'BU.3', 'BA.5.2.18', 'CR.1', 'CR.1.1', 'CR.1.2', 'CR.1.3', 'CR.2', 'BA.5.2.19', 'BA.5.2.20', 'BV.1', 'BV.2', 'BA.5.2.21', 'CN.1', 'CN.2', 'BA.5.2.22', 'BA.5.2.23', 'BA.5.2.24', 'CK.1', 'CK.1.1', 'CK.1.2', 'CK.2', 'CK.2.1', 'CK.2.1.1', 'CK.3', 'DG.1', 'BA.5.2.25', 'DB.1', 'DB.2', 'BA.5.2.26', 'BA.5.2.27', 'CF.1', 'CG.1', 'BA.5.2.28', 'BA.5.2.29', 'BA.5.2.30', 'BA.5.2.31', 'CD.1', 'CD.2', 'BA.5.2.32', 'BA.5.2.33', 'CE.1', 'BA.5.2.34', 'BA.5.2.35', 'BA.5.2.36', 'CT.1', 'BA.5.2.37', 'BA.5.2.38', 'DA.1', 'BA.5.2.39', 'BA.5.2.40', 'BA.5.2.41', 'BA.5.2.42', 'BA.5.2.43', 'BA.5.2.44', 'BA.5.2.45', 'BA.5.2.46', 'BA.5.2.47', 'DQ.1', 'BA.5.2.48', 'DY.1', 'DY.1.1', 'BA.5.2.49', 'DZ.1', 'DZ.2', 'BA.5.2.50', 'BA.5.3', 'BA.5.3.1', 'BE.1', 'BE.1.1', 'BE.1.1.1', 'BQ.1', 'BQ.1.1', 'BQ.1.1.1', 'CZ.1', 'BQ.1.1.2', 'DU.1', 'BQ.1.1.3', 'DR.1', 'BQ.1.1.4', 'BQ.1.1.5', 'DN.1', 'DN.1.1', 'DN.1.1.1', 'DN.1.1.2', 'BQ.1.1.6', 'BQ.1.1.7', 'DK.1', 'BQ.1.1.8', 'DP.1', 'BQ.1.1.9', 'BQ.1.1.10', 'BQ.1.1.11', 'BQ.1.1.12', 'BQ.1.1.13', 'BQ.1.1.14', 'CW.1', 'BQ.1.1.15', 'DM.1', 'BQ.1.1.16', 'BQ.1.1.17', 'BQ.1.1.18', 'BQ.1.1.19', 'BQ.1.1.20', 'BQ.1.1.21', 'BQ.1.1.22', 'BQ.1.1.23', 'BQ.1.1.24', 'BQ.1.1.25', 'BQ.1.1.26', 'BQ.1.1.27', 'BQ.1.1.28', 'BQ.1.1.29', 'BQ.1.1.30', 'BQ.1.1.31', 'BQ.1.1.32', 'DT.1', 'BQ.1.1.34', 'BQ.1.1.35', 'BQ.1.1.36', 'BQ.1.1.37', 'BQ.1.1.38', 'BQ.1.1.39', 'BQ.1.1.40', 'BQ.1.1.41', 'BQ.1.1.42', 'BQ.1.1.43', 'BQ.1.1.44', 'BQ.1.1.45', 'BQ.1.1.46', 'BQ.1.1.47', 'BQ.1.1.48', 'BQ.1.1.49', 'BQ.1.2', 'BQ.1.2.1', 'BQ.1.3', 'BQ.1.4', 'BQ.1.5', 'BQ.1.6', 'BQ.1.7', 'BQ.1.8', 'BQ.1.8.1', 'BQ.1.8.2', 'BQ.1.9', 'BQ.1.10', 'BQ.1.10.1', 'BQ.1.11', 'BQ.1.11.1', 'BQ.1.12', 'BQ.1.13', 'BQ.1.13.1', 'BQ.1.14', 'BQ.1.15', 'BQ.1.16', 'BQ.1.17', 'BQ.1.18', 'BQ.1.19', 'BQ.1.20', 'BQ.1.21', 'BQ.1.22', 'BQ.1.23', 'BQ.1.24', 'BQ.1.25', 'BQ.1.25.1', 'BQ.1.26', 'BQ.1.26.1', 'BQ.1.27', 'BQ.1.28', 'BQ.2', 'BE.1.2', 'BE.1.1.2', 'CC.1', 'BE.1.2.1', 'DW.1', 'BE.1.3', 'BE.1.4', 'BE.1.4.1', 'BE.1.4.2', 'BE.1.4.3', 'BE.1.4.4', 'BE.2', 'BE.3', 'BE.4', 'BE.4.1', 'BE.4.1.1', 'CQ.1', 'CQ.1.1', 'CQ.2', 'BE.4.2', 'BE.5', 'BE.6', 'BE.7', 'BE.8', 'BE.9', 'BE.10', 'BA.5.3.2', 'BA.5.3.3', 'BA.5.3.4', 'BA.5.3.5', 'BA.5.5', 'BA.5.5.1', 'BA.5.5.2', 'BA.5.5.3', 'BA.5.6', 'BA.5.6.1', 'BA.5.6.2', 'BA.5.6.3', 'BA.5.6.4', 'BW.1', 'BW.1.1', 'BA.5.7', 'BA.5.8', 'BA.5.9', 'BA.5.10', 'BA.5.10.1', 'DF.1', 'DF.1.1', 'BA.5.11']"

#  omicron_ba_four:
#    region: global
#    country: Norway
#    subsampling_scheme: omicron-bafour-scheme
#    pango_lineage: "['BA.2', 'BA.2.1', 'BA.2.2', 'BA.2.3', 'BA.2.3.1', 'BA.2.3.2', 'BA.2.3.3', 'BA.2.3.4', 'BA.2.3.5', 'BA.2.3.6', 'BA.2.3.7', 'BA.2.3.8', 'BA.2.3.9', 'BA.2.3.10', 'BA.2.3.11', 'BA.2.3.12', 'BA.2.3.13', 'BA.2.3.14', 'BA.2.3.15', 'BA.2.3.16', 'BA.2.3.17', 'BA.2.3.18', 'BA.2.4', 'BA.2.5', 'BA.2.6', 'BA.2.7', 'BA.2.8', 'BA.2.9', 'BA.2.9.1', 'BA.2.9.2', 'BA.2.9.3', 'BA.2.9.4', 'BA.2.10', 'BA.2.10.1', 'BA.2.10.2', 'BA.2.10.3', 'BA.2.11', 'BA.2.12', 'BA.2.12.1', 'BA.2.12.2', 'BA.2.13', 'BA.2.14', 'BA.2.15', 'BA.2.16', 'BA.2.17', 'BA.2.18', 'BA.2.19', 'BA.2.20', 'BA.2.21', 'BA.2.22', 'BA.2.23', 'BA.2.23.1', 'BA.2.24', 'BA.2.25', 'BA.2.25.1', 'BA.2.26', 'BA.2.27', 'BA.2.28', 'BA.2.29', 'BA.2.30', 'BA.2.31', 'BA.2.32', 'BA.2.33', 'BA.2.34', 'BA.2.35', 'BA.2.36', 'BA.2.37', 'BA.2.38', 'BA.2.39', 'BA.2.40', 'BA.2.40.1','BA.2.41', 'BA.2.42', 'BA.2.43', 'BA.2.44', 'BA.2.45', 'BA.2.46', 'BA.2.47', 'BA.2.48', 'BA.2.49', 'BA.2.50', 'BA.2.51', 'BA.2.52', 'BA.2.53', 'BA.2.54', 'BA.2.55', 'BA.2.56', 'BA.2.57', 'BA.2.58', 'BA.2.59', 'BA.2.60', 'BA.2.61', 'BA.2.62', 'BA.2.63', 'BA.2.64', 'BA.2.65', 'BA.2.66', 'BA.2.67', 'BA.2.68', 'BA.2.69', 'BA.2.70', 'BA.2.71', 'BA.2.72', 'BA.3', 'BA.3.1', 'BA.4', 'BA.4.1', 'BA.4.2', 'BA.5', 'BA.5.1', 'BA.5.2', 'BA.5.3', 'BA.5.4', 'BA.5.5', 'XE', 'XG', 'XH', 'XJ', 'XK', 'XL', 'XM', 'XN', 'XP', 'XQ', 'XR', 'XT', 'XU']"

 #  Nor-omicron-all:
 #   region: global
 #   country: Norway
 #   subsampling_scheme: all

subsampling:

  omicron-batwo-scheme:
    country:
      group_by: "year month"
      max_sequences: 30000
#      query: --query "(country == '{country}') & (pango_lineage in {pango_lineage})"
      query: --query "(country == '{country}') & (pango_lineage.str.startswith('BA.2.75.2'))"
    related:
      group_by: "country year month"
      max_sequences: 1000
      sampling_scheme: "--probabilistic-sampling"
#      query: --query "(country != '{country}') & (pango_lineage in {pango_lineage})"
      query: --query "(country != '{country}') & (pango_lineage.str.startswith('BA.2.75.2'))"
      priorities:
        type: "proximity"
        focus: "country"
  omicron-bq-scheme:
    country:
      query: --query "(country == '{country}') & (pango_lineage.str.startswith('BQ.1'))"
    related:
      group_by: "country"
      max_sequences: 1000
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country != '{country}') & (pango_lineage.str.startswith('BQ.1'))"
      priorities:
        type: "proximity"
        focus: "country"
  omicron-bafive-scheme:
    country:
      group_by: "year month"
      max_sequences: 30000
      query: --query "(country == '{country}') & (pango_lineage in {pango_lineage})"
#      query: --query "(country == '{country}')"
    related:
      group_by: "country"
      max_sequences: 1000
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country != '{country}') & (pango_lineage in {pango_lineage})"
#      query: --query "(country != '{country}')"
      priorities:
        type: "proximity"
        focus: "country"

  omicron-bafour-scheme:
    country:
      group_by: "year month"
      max_sequences: 30000
#     query: --query "(country == '{country}') & (pango_lineage in {pango_lineage})"
      query: --query "(country == '{country}') & (pango_lineage.str.startswith('BA.4'))"
    related:
      group_by: "country year month"
      max_sequences: 2000
      sampling_scheme: "--probabilistic-sampling"
#      query: --query "(country != '{country}') & (pango_lineage in {pango_lineage})"
      query: --query "(country != '{country}') & (pango_lineage.str.startswith('BA.4'))"
      priorities:
        type: "proximity"
        focus: "country"

# remove S dropout sequences and sequences without division label in US
filter:
  exclude_where: "division='USA' purpose_of_sequencing='S dropout'"
  # Removing sequences with lower than 99% coverage
  min_length: 28500
  # I don't want Omicron sequences that are before autumn 2021.
  min_date: 2021.75

inputs:
#    metadata: "s3://nextstrain-ncov-private/metadata.tsv.gz"
#    filtered: "s3://nextstrain-ncov-private/filtered.fasta.xz"
  - name: gisaid
    metadata: data/SC2_weekly/Gisaid.metadata.tsv
    sequences: data/SC2_weekly/Gisaid.fasta
  - name: BN
    metadata: data/SC2_weekly/BN.metadata.tsv
    sequences: data/SC2_weekly/BN.fasta

# Define frequencies parameters.
frequencies:
    recent_days_to_censor: 7


# Here, you can specify what type of auspice_config you want to use
# and what description you want. These will apply to all the above builds.
# If you want to specify specific files for each build - you can!
# See the 'example_advanced_customization' builds.yaml

# Change "columns" to "location" for augur traits when having only a single country
diagnostic:
  skip_inputs_arg=_get_skipped_inputs_for_diagnostic: true
  clock_filter: 20 # 20 default
  snp_clusters: 1 # 1 default
  contamination: 5 # 5 default


traits:
  default:
    sampling_bias_correction: 2.5
    columns: ["country"]

# Change root to South African omicron / BEST
refine:
#  root: "SouthAfrica/NICD-N22102/2021"
  root: "best"

files:
  auspice_config: "my_profiles/omicron/my_auspice_config.json"
  description: "my_profiles/omicron/my_description.md"
  colors: "my_profiles/omicron/colors_norwaydivisions.tsv"
  sites_to_mask: "my_profiles/omicron/sites_ignored_for_tree_topology.txt"
#  alignment_reference: "my_profiles/omicron/reference_seq.fa"
#  include: "my_profiles/omicron/include.txt"
#  emerging_lineages: "my_profiles/omicron/emerging_lineages.tsv"
# lat_longs: "my_profiles/fhi/lat_longs.tsv"
